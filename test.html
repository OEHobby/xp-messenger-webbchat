<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="//oskaremilsson.se/chat/style.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
	
</head>
<body>
<div id="wrapper">
	<div id="window" class="ui-widget-content">
		<div id="xp-bar">
			<p class="program-title">MSN Messenger (online)</p>
			<div id="minimize-button" class="blue-xp-button"><p class="xp-button-text">_</p></div>
			<div id="maximize-button" class="blue-xp-button"><p class="xp-button-text">[]</p></div>
			<div id="close-button" class="red-xp-button"><p class="xp-button-text">X</p></div>
		</div>
		<div id="head">
			<div id="nickWrapper">
				<div id="msn-head"></div>
				<p class="nickName">Kittyface</p>
				<p class="nickStatus">Filurar på något mystiskt.</p>
			</div>
			<div id="head-symbol" class="head-symbol-1"></div>
			<div id="head-symbol" class="head-symbol-2"></div>
			<div id="head-symbol" class="head-symbol-3"></div>
			<div id="head-symbol" class="head-symbol-4"></div>
			<div id="head-symbol" class="head-symbol-5"></div>
			<div id="head-symbol" class="head-symbol-6"></div>
			<div id="head-symbol" class="head-symbol-7"></div>
		</div>
		<div id="chatWindow"></div>
		<div id="rightBar">
			<div id="profilePicture1" class="duck"><img src="//oskaremilsson.se/chat/img/profile_pic.png"></div>
			
		</div>
		<div id="bottomBar">
			<div id="profilePicture2" class="rocket"><img src="//oskaremilsson.se/chat/img/profile_pic.png"></div>
			<div id="smiley-bar">
				<div id="smiley-symbol" class="smiley-symbol-1"></div>
				<div id="smiley-symbol" class="smiley-symbol-2"></div>
				<div id="smiley-symbol-vibb" class="smiley-symbol-3"></div>
				<div id="smiley-symbol" class="smiley-symbol-4"></div>
				<div id="smiley-symbol" class="smiley-symbol-5"></div>
				<div id="smiley-symbol" class="smiley-symbol-6"></div>
			</div>
			<div id="text-field">
				<form action="">
					<input type="text" id="m" autocomplete="off">
			</div>
			<button class="button">Send</button></form>
		</div>
	</div>
</div>
<div id="start-menu">
	<div id="start-button"><img src="//oskaremilsson.se/chat/img/start.png"></div>
	<div id="ie-short-small"></div>
	<div id="messenger-mini"><p class="start-menu-link">MSN Messenger</p></div>
</div>

<script>
		$( "#window" ).draggable({ disabled: true });
		var xpbar = document.getElementById('xp-bar');
		xpbar.addEventListener("mousedown", function() {
			$( "#window" ).draggable( "option", "disabled", false );
		});
		xpbar.addEventListener("mouseup", function() {
			$( "#window" ).draggable( "option", "disabled", true );
		});
</script>

<script type="text/javascript">
function moveWindow(jump, dir)
	{
		if(dir == "right")
		{
			$("#window").offset({ top: $("#window").position().top, left: ($("#window").position().left + jump) });
			console.log("moving right.");
		}
		else if(dir == "left")
		{
			$("#window").offset({ top: $("#window").position().top, left: ($("#window").position().left - jump) });
			console.log("moving left.");
		}
		else if(dir == "up")
		{
			$("#window").offset({ top: ($("#window").position().top - jump), left: $("#window").position().left });
			console.log("moving up.");
		}
		else if(dir == "down")
		{
			$("#window").offset({ top: ($("#window").position().top + jump), left: $("#window").position().left });
			console.log("moving down.");
		}
	}

function vibb(jump)
{
	console.log("vibbar");
	setTimeout(function(){moveWindow(jump, "left");}, 50);
	setTimeout(function(){moveWindow(jump, "up");}, 30);
	setTimeout(function(){moveWindow(jump, "right");}, 80);
	setTimeout(function(){moveWindow(jump, "down");}, 70);
	setTimeout(function(){moveWindow(jump, "left");}, 60);
	setTimeout(function(){moveWindow(jump, "up");}, 20);
	setTimeout(function(){moveWindow(jump, "right");}, 75);
	setTimeout(function(){moveWindow(jump, "down");}, 65);

	setTimeout(function(){moveWindow(jump, "left");}, 68);
	setTimeout(function(){moveWindow(jump, "up");}, 72);
	setTimeout(function(){moveWindow(jump, "right");}, 85);
	setTimeout(function(){moveWindow(jump, "down");}, 28);
	setTimeout(function(){moveWindow(jump, "left");}, 91);
	setTimeout(function(){moveWindow(jump, "up");}, 45);
	setTimeout(function(){moveWindow(jump, "right");}, 35);
	setTimeout(function(){moveWindow(jump, "down");}, 55);
}

var vibber = document.getElementById('smiley-symbol-vibb');
vibber.addEventListener("click", function() {
		vibb(10);vibb(10);vibb(10);
	});
</script>

<script>
var minimize = document.getElementById("minimize-button");
minimize.addEventListener("click", function(){ console.log("klick"); $("#window").addClass("hide"); });

var pickup = document.getElementById("messenger-mini");
pickup.addEventListener("click", function(){ 
	console.log("klick"); 

	//$("#window").removeClass("hide"); 
	var classList = $('#window').attr('class').split(/\s+/);
	$.each( classList, function(index, item)
	{
    	if (item === 'hide') 
    	{
       		$("#window").removeClass("hide");
    	}
    	else
    	{
    		$("#window").addClass("hide");
    	}
    });
});

var maxi = document.getElementById("maximize-button");
maxi.addEventListener("click", function(){maximize();});

function maximize()
{
	//maximize window
	$("#window").width($(window).width() - 12);
	$("#window").height($(window).height() - 10);
	$("#window").offset({top:0, left:0});
	//maximize head, xp-bar, bottom, textfield, smiley-bar
	$("#head").width($(window).width() - 12);
	$("#bottomBar").width($(window).width() - 12);
	$("#xp-bar").width($(window).width() - 12);
	$("#nickwrapper").width($(window).width() - 12);

	$("#text-field").width( $(window).width() - $("#rightBar").width()  - 12);
	$("#text-field input[type=text]").width( $(window).width() - $("#rightBar").width()  - 12) ;
	$("#smiley-bar").width( $(window).width() - $("#rightBar").width() - 12);
	$("#chatWindow").width( $(window).width() - $("#rightBar").width()  - 12);
	$("#chatWindow").height( $(window).height() - ($("#head").height() + $("#bottomBar").height() + $("#xp-bar").height())  - 10);
	$("#right-bar").height($(window).height() - 10);

}
</script>
<script src="//oskaremilsson.se/chat/resize.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
	  var socket = io();
	  $('form').submit(function(){
	    socket.emit('chat message', $('#m').val());
	    $('#m').val('');
	    return false;
	  });

	socket.on('chat message', function(msg){
		console.log(msg);
		var nick = msg.split(":")[0];
		console.log("nick: " + nick);
		var message = msg.split(": ")[1];
	    $('#chatWindow').html( $('#chatWindow').html() + '<p class="chatTitle">' + nick + ' säger:</p>' + '<p class="chatMessage">' + message + '</p>');

	    
		$("#chatWindow").scrollTop($("#chatWindow")[0].scrollHeight);
		console.log($("#chatWindow")[0].scrollHeight);
	    //$('#chatWindow').append($('<li>').text(msg));
	  });
</script>

</body>
</html>